<div class="min-h-screen bg-gray-100 p-4 sm:p-6 lg:p-8">
    <div *ngIf="isLoading" class="text-center flex items-center justify-center h-screen">Memuat detail riwayat...</div>
  
    <div *ngIf="!isLoading && bill" class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-7xl mx-auto">
      
      <aside class="bg-white p-4 rounded-lg shadow-md self-start">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold">Struk Asli</h2>
          <a routerLink="/dashboard" class="text-sm font-medium text-indigo-600 hover:text-indigo-500">&larr; Kembali ke Dashboard</a>
        </div>
        <div class="image-container overflow-auto max-h-[80vh]">
          <img [src]="bill.imageUrl" alt="Gambar Struk" class="w-full h-auto rounded">
        </div>
      </aside>
  
      <main class="bg-white p-6 rounded-lg shadow-md space-y-6">
        
        <header class="flex justify-between items-start">
            <div>
              <h1 class="text-2xl font-bold text-gray-900">{{ bill.storeName || 'Detail Transaksi' }}</h1>
              <p class="text-gray-500">{{ bill.purchaseDate | date:'fullDate' }}</p>
            </div>
            <a [routerLink]="['/dashboard/split', bill.id]" class="flex-shrink-0 ml-4 bg-blue-100 text-blue-700 font-semibold py-2 px-4 rounded-lg hover:bg-blue-200 transition">
              Edit Pembagian
            </a>
          </header>

          <div class="pt-6 border-t mt-6">
            <h3 class="text-lg font-semibold text-red-600">Zona Berbahaya</h3>
            <p class="text-sm text-gray-500 mt-1 mb-4">Aksi di bawah ini tidak dapat dibatalkan.</p>
            <button (click)="onDelete()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
              {{ isLoading ? 'Menghapus...' : 'Hapus Transaksi Ini' }}
            </button>
          </div>
  
        <section *ngIf="bill.splitDetails && participantNames.length > 0">
          <h3 class="text-lg font-semibold border-b pb-2 mb-4">Hasil Pembagian</h3>
          <div class="space-y-6">
            
            <div *ngFor="let name of participantNames" class="participant-card border border-gray-200 p-4 rounded-lg">
              <div class="flex justify-between items-center mb-3">
                <h4 class="text-xl font-semibold text-indigo-700">{{ name }}</h4>
                <p class="text-xl font-bold text-green-600">Rp {{ bill.splitDetails[name].total | number:'1.0-0' }}</p>
              </div>
              
              <ul class="text-sm space-y-2">
                <li *ngFor="let item of bill.splitDetails[name].items" class="flex justify-between text-gray-600 border-t pt-2">
                  <span>{{ item.name }}</span>
                  <span class="font-medium">Rp {{ item.paidAmount | number:'1.0-0' }}</span>
                </li>
                <li *ngIf="getAdditionalCostsShare(name) > 0" class="flex justify-between text-gray-500 italic border-t pt-2">
                  <span>Pajak & Servis</span>
                  <span class="font-medium">Rp {{ getAdditionalCostsShare(name) | number:'1.0-0' }}</span>
                </li>
              </ul>
              </div>
  
          </div>
        </section>
        
        <div class="flex justify-between items-center bg-gray-800 text-white p-4 rounded-lg mt-6">
          <span class="font-bold text-lg">TOTAL KESELURUHAN</span>
          <span class="font-bold text-2xl">Rp {{ bill.total | number }}</span>
        </div>
        <section *ngIf="!bill.splitDetails" class="text-center text-gray-500 py-8">
          </section>
  
      </main>
    </div>
  </div>